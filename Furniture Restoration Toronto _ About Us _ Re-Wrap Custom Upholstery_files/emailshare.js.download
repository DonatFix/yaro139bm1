"use strict";var _monoEmailShare={$body:$("body"),clickEvent:"click",modules:$(".emailshare"),$forms:$(".emailshare form"),recaptchaToken:"",captchaInst:"",init:function(){Modernizr.touchevents&&(this.clickEvent="tap"),this.modules.each(function(a,e){var r=$(e).find("a[data-overlay-trigger]"),t=$(e).find("form"),i=t.parents(".module").attr("id");$(r).monooverlay({callback:function(){t.find("#errors_"+i).empty(),t.find(".formcaptcha-"+i).contents().length<1&&_monoEmailShare.initRecaptcha(t)}})})},handleForm:function(a){var e=this,r=$(a),t=this.validateFields(r);return t.valid?($.ajax({type:"POST",url:r.attr("data-url"),data:r.serialize(),success:function(){var a=jQuery.Event(this.clickEvent);r.parents(".module").find("a[data-overlay-trigger]").length?r.parents(".module").find("a[data-overlay-trigger]").data("monooverlay").close(a):r.parents(".notification").length&&r.parents(".notification").find(".closeBtn").trigger(e.clickEvent)}}),window._mtr&&r.attr("data-track-action")&&window._mtr.track(r.attr("data-track-action"))):this.showFieldErrors(r,t.fields),!1},validateFields:function(a){var e=a.find("input, select, textarea").not(":disabled, [type=submit]"),r={valid:!0,fields:{}};e.each(function(a,e){var t=$(e),i=t.attr("name").replace("[]","");!t.attr("data-required")||t.attr("data-required")&&""!==t[0].value?(r.fields[i]=!0,"email"==t.attr("data-type")&&t.val().length>0&&!t.val().match(/^[a-zA-Z0-9_\.\-+]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/)&&(r.fields[i]="notValidEmail")):r.fields[i]=!1,"g-recaptcha-response"==i&&(t[0].value?r.fields[i]=!0:r.fields[i]=!1)});for(var t in r.fields)if(r.fields[t]===!1||"notValidEmail"==r.fields[t]){r.valid=!1;break}return r},showFieldErrors:function(a,e){var r,t=a.parents(".module").attr("id"),i=[];a.find(".error").empty(),a.find("#errors_"+t).empty().append('<div class="errors"></div>');for(r in e)if(a.find('*[name="'+r+'"]').removeClass("requiredMark"),a.find("span.label_"+r).removeClass("requiredMarkLabel"),"g-recaptcha-response"!=r||e[r]!==!1)if(e[r]===!1){var n=a.find("label[for="+t+"_"+r+"]").text(),d=a.find('*[name="'+r+'"]').attr("placeholder")?a.find('*[name="'+r+'"]').attr("placeholder"):"",l=n.replace(/\s/g,"").length>0?n:d;a.find("div#errors_"+t+" .errors").append("<p>* '"+l.replace(/\s$/,"").replace(/\*$/,"")+"' "+_monoLang.get("##MODULE_FORM_ERR_REQUIRED##")+"</p>"),a.find('*[name="'+r+'"]').addClass("requiredMark"),a.find("span.label_"+r).addClass("requiredMarkLabel"),i.push(r)}else"notValidEmail"==e[r]&&(a.find("div#errors_"+t+" .errors").append("<p>* '"+a.find("label[for="+t+"_"+r+"]").text()+"' "+_monoLang.get("##MODULE_FORM_ERR_EMAIL##")+"</p>"),a.find("span#error_"+t+"_"+r).append("*"));else a.find("div#errors_"+t+" .errors").append("<p>* "+_monoLang.get("##MODULE_FORM_ERR_RECAPTCHA##")+"</p>");i.length>0&&a.find('*[name="'+i[0]+'"]').trigger("focus"),a.parents(".module").find("a[data-overlay-trigger]").length&&a.parents(".module").find("a[data-overlay-trigger]").data("monooverlay").assertScroll()},initRecaptcha:function(a){var e=this,r=a.parents(".module").attr("id"),t=$(a).find(".formcaptcha-"+r);return t.contents().length?(grecaptcha.reset(e.captchaInst),!0):void(e.captchaInst=grecaptcha.render(t[0],{sitekey:t.attr("data-sitekey"),size:$(window).width()>767?"normal":"compact"}))}};_monoEmailShare.init();